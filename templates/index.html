<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Face Recognition Client</title>
  </head>
  <body>
    <h3>Client Webcam with Face Recognition</h3>
    <video id="video" width="640" height="480" autoplay></video>
    <canvas id="canvas" width="640" height="480" style="display: none"></canvas>
    <p id="result">Recognized: None</p>

    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const resultText = document.getElementById("result");
      const context = canvas.getContext("2d");

      // Start the webcam stream
      navigator.mediaDevices
        .getUserMedia({ video: true })
        .then((stream) => {
          video.srcObject = stream;
        })
        .catch((err) => {
          console.error("Camera access error: ", err);
        });

      // Send a frame every second
      setInterval(() => {
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const dataURL = canvas.toDataURL("image/jpeg");

        fetch("/process_frame", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ image: dataURL }),
        })
          .then((response) => response.json())
          .then((data) => {
            resultText.textContent = `Recognized: ${data.name}`;
          })
          .catch((err) => {
            console.error("Error sending frame:", err);
          });
      }, 1000); // adjust timing as needed
    </script>
  </body>
</html>
